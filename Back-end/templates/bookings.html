<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Appointment</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex justify-center items-center p-4">

  <div class="w-full max-w-2xl bg-white rounded-2xl shadow-lg p-6">

        <h2 id="monthTitle" class="text-2xl font-semibold mb-4 text-center"></h2>

        <div id="daysContainer" class="flex justify-center gap-2 mb-6 flex-wrap"></div>

        <div id="timesContainer" class="flex justify-center gap-2 mb-6 flex-wrap"></div>

        <div id="summary" class="border rounded-lg p-4 mb-4 hidden">
      <div class="flex justify-between items-center mb-2">
        <h3 id="serviceName" class="font-medium">Women's French Braid (Adriana)</h3>
        <span id="servicePrice" class="font-semibold text-gray-800">$240.00</span>
      </div>
      <p id="timeSummary" class="text-sm text-gray-500"></p>
    </div>

        <div id="totalSection" class="flex justify-between text-gray-700 text-lg font-medium mb-6 hidden">
      <span>Total:</span>
      <span>$240.00 (2 hours)</span>
    </div>

        <form id="bookingForm" method="POST" action="#" class="flex flex-col gap-4">
      <input type="hidden" id="bookingType" name="booking_type" value="Women's French Braid (Adriana)" />
      <input type="hidden" id="appointmentDatetime" name="appointment_datetime" value="" />

      <button type="submit" id="continueBtn" disabled
        class="w-full py-3 bg-cyan-600 text-white rounded-lg font-medium hover:bg-cyan-700 transition">
        Continue
      </button>
    </form>

  </div>

  <script>
    const service = {
      name: "Women's French Braid (Adriana)",
      price: 240,
      duration: 2
    };

    const availableTimes = {
      '2025-12-04': ['9:00 AM', '11:15 AM', '1:15 PM'],
      '2025-12-05': ['10:00 AM', '12:30 PM'],
      '2025-12-06': ['9:00 AM', '11:15 AM', '1:15 PM'],
      '2025-12-07': ['8:30 AM', '2:00 PM']
    };

    const monthTitle = document.getElementById('monthTitle');
    const daysContainer = document.getElementById('daysContainer');
    const timesContainer = document.getElementById('timesContainer');
    const timeSummary = document.getElementById('timeSummary');
    const summary = document.getElementById('summary');
    const totalSection = document.getElementById('totalSection');
    const continueBtn = document.getElementById('continueBtn');
    const bookingForm = document.getElementById('bookingForm'); // Get the form element

    const appointmentInput = document.getElementById('appointmentDatetime');
    const bookingTypeInput = document.getElementById('bookingType');

    let selectedDate = null;
    let selectedTime = null;

    function renderCalendar() {
      monthTitle.textContent = "December 2025";
      daysContainer.innerHTML = '';

      Object.keys(availableTimes).forEach(date => {
        const d = new Date(date);
        const dayName = d.toLocaleDateString('en-US', { weekday: 'short' });
        const dayNum = d.getDate();

        const btn = document.createElement('button');
        btn.textContent = `${dayName} ${dayNum}`;
        btn.className = "px-3 py-2 rounded-lg bg-gray-100 hover:bg-cyan-100 transition";
        btn.onclick = () => selectDay(date, btn);

        daysContainer.appendChild(btn);
      });
    }

    function selectDay(date, button) {
      selectedDate = date;
      selectedTime = null;
      summary.classList.add('hidden');
      totalSection.classList.add('hidden');
      continueBtn.disabled = true;

      [...daysContainer.children].forEach(b => {
        b.classList.remove('bg-cyan-600', 'text-white');
        b.classList.add('bg-gray-100');
      });
      button.classList.add('bg-cyan-600', 'text-white');

      renderTimes(date);
    }

    function renderTimes(date) {
      timesContainer.innerHTML = '';
      availableTimes[date].forEach(time => {
        const btn = document.createElement('button');
        btn.textContent = time;
        btn.className = "px-4 py-2 rounded-lg bg-gray-100 hover:bg-cyan-100 transition";
        btn.onclick = () => selectTime(time, btn);
        timesContainer.appendChild(btn);
      });
    }

    function selectTime(time, button) {
      selectedTime = time;

      [...timesContainer.children].forEach(b => {
        b.classList.remove('bg-cyan-600', 'text-white');
        b.classList.add('bg-gray-100');
      });
      button.classList.add('bg-cyan-600', 'text-white');

      summary.classList.remove('hidden');
      totalSection.classList.remove('hidden');

      continueBtn.disabled = false;

      appointmentInput.value = `${selectedDate} ${selectedTime}`;
      bookingTypeInput.value = service.name;

      const endTime = calculateEndTime(time, service.duration);
      timeSummary.textContent = `${time} – ${endTime}`;
    }

    function calculateEndTime(start, hours) {
      const [t, modifier] = start.split(' ');
      let [h, m] = t.split(':').map(Number);
      if (modifier === 'PM' && h !== 12) h += 12;
      if (modifier === 'AM' && h === 12) h = 0;

      const date = new Date();
      date.setHours(h + hours, m);
      return date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
    }

    // --- Indirect Script Handler ---
    bookingForm.addEventListener('submit', function (e) {
        e.preventDefault(); // Stop the form from trying to submit itself
        
        // This is where you would normally send the data to a server (e.g., using fetch)
        
        // Save the chosen appointment to localStorage so the next page can use it
        const bookingData = {
            date: selectedDate,
            time: selectedTime,
            datetime: appointmentInput.value,
            service: bookingTypeInput.value
        };
        localStorage.setItem('pendingBooking', JSON.stringify(bookingData));

        // Redirect the user to the login/signup page
        window.location.href = '/'; // Redirect to the specified page
    });
    // -------------------------------

    renderCalendar();
  </script>
</body>
</html>
